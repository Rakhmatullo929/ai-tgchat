<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartGroupBot - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .data-table {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #667eea;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-secondary {
            background: #e2e3e5;
            color: #383d41;
        }

        .badge-positive {
            background: #d1ecf1;
            color: #0c5460;
        }

        .badge-neutral {
            background: #fff3cd;
            color: #856404;
        }

        .badge-negative {
            background: #f8d7da;
            color: #721c24;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: background 0.3s ease;
        }

        .refresh-btn:hover {
            background: #5a6fd8;
        }

        .section-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ SmartGroupBot</h1>
            <p>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏</p>
        </div>

        <button class="refresh-btn" onclick="refreshData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>

        <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-grid" id="statsGrid">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</div>
        </div>

        <!-- –ì—Ä–∞—Ñ–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π -->
        <div class="chart-container">
            <h2 class="section-title">üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π</h2>
            <canvas id="sentimentChart" width="400" height="200"></canvas>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ -->
        <div class="data-table">
            <h2 class="section-title">üí¨ –ê–∫—Ç–∏–≤–Ω—ã–µ —á–∞—Ç—ã</h2>
            <div id="chatsTable">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–æ–≤...</div>
            </div>
        </div>

        <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="data-table">
            <h2 class="section-title">üìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è</h2>
            <div id="interactionsTable">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π...</div>
            </div>
        </div>
    </div>

    <script>
        let sentimentChart = null;

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });

        async function loadData() {
            await Promise.all([
                loadOverviewStats(),
                loadChats(),
                loadInteractions()
            ]);
        }

        async function refreshData() {
            const btn = document.querySelector('.refresh-btn');
            btn.textContent = '‚è≥ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...';
            btn.disabled = true;
            
            await loadData();
            
            btn.textContent = 'üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ';
            btn.disabled = false;
        }

        async function loadOverviewStats() {
            try {
                const response = await fetch('/api/overview');
                const data = await response.json();
                
                const statsGrid = document.getElementById('statsGrid');
                statsGrid.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${data.total_interactions}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${data.responses_generated}</div>
                        <div class="stat-label">–û—Ç–≤–µ—Ç–æ–≤ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${data.unique_chats}</div>
                        <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${data.recent_interactions}</div>
                        <div class="stat-label">–ó–∞ 24 —á–∞—Å–∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${data.response_rate.toFixed(1)}%</div>
                        <div class="stat-label">–ß–∞—Å—Ç–æ—Ç–∞ –æ—Ç–≤–µ—Ç–æ–≤</div>
                    </div>
                `;

                // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
                updateSentimentChart(data.sentiment_distribution);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                document.getElementById('statsGrid').innerHTML = '<div class="loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        }

        function updateSentimentChart(sentimentData) {
            const ctx = document.getElementById('sentimentChart').getContext('2d');
            
            if (sentimentChart) {
                sentimentChart.destroy();
            }
            
            sentimentChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ', '–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ', '–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ'],
                    datasets: [{
                        data: [
                            sentimentData.positive,
                            sentimentData.neutral,
                            sentimentData.negative
                        ],
                        backgroundColor: [
                            '#28a745',
                            '#ffc107',
                            '#dc3545'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        async function loadChats() {
            try {
                const response = await fetch('/api/chats');
                const chats = await response.json();
                
                const chatsTable = document.getElementById('chatsTable');
                
                if (chats.length === 0) {
                    chatsTable.innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —á–∞—Ç–∞—Ö</p>';
                    return;
                }
                
                let tableHTML = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞</th>
                                <th>–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π</th>
                                <th>–û—Ç–≤–µ—Ç–æ–≤</th>
                                <th>–ß–∞—Å—Ç–æ—Ç–∞</th>
                                <th>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                chats.forEach(chat => {
                    tableHTML += `
                        <tr>
                            <td><strong>${chat.chat_title}</strong></td>
                            <td>${chat.total_interactions}</td>
                            <td>${chat.responses_generated}</td>
                            <td>${chat.response_rate.toFixed(1)}%</td>
                            <td>${chat.last_activity ? new Date(chat.last_activity).toLocaleString('ru-RU') : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</td>
                        </tr>
                    `;
                });
                
                tableHTML += '</tbody></table>';
                chatsTable.innerHTML = tableHTML;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–æ–≤:', error);
                document.getElementById('chatsTable').innerHTML = '<div class="loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        }

        async function loadInteractions() {
            try {
                const response = await fetch('/api/interactions');
                const interactions = await response.json();
                
                const interactionsTable = document.getElementById('interactionsTable');
                
                if (interactions.length === 0) {
                    interactionsTable.innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è—Ö</p>';
                    return;
                }
                
                let tableHTML = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>–í—Ä–µ–º—è</th>
                                <th>–ß–∞—Ç</th>
                                <th>–¢–µ–º–∞</th>
                                <th>–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</th>
                                <th>–û—Ç–≤–µ—Ç</th>
                                <th>–û—Ç–≤–µ—Ç –±–æ—Ç–∞</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                interactions.forEach(interaction => {
                    const sentimentBadge = getSentimentBadge(interaction.sentiment);
                    const responseBadge = interaction.response_generated ? 
                        '<span class="badge badge-success">–î–∞</span>' : 
                        '<span class="badge badge-secondary">–ù–µ—Ç</span>';
                    
                    tableHTML += `
                        <tr>
                            <td>${new Date(interaction.timestamp).toLocaleString('ru-RU')}</td>
                            <td>${interaction.chat_title || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</td>
                            <td>${interaction.detected_topic || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞'}</td>
                            <td>${sentimentBadge}</td>
                            <td>${responseBadge}</td>
                            <td>${interaction.bot_response || '-'}</td>
                        </tr>
                    `;
                });
                
                tableHTML += '</tbody></table>';
                interactionsTable.innerHTML = tableHTML;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π:', error);
                document.getElementById('interactionsTable').innerHTML = '<div class="loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        }

        function getSentimentBadge(sentiment) {
            if (!sentiment) return '<span class="badge badge-secondary">–ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ</span>';
            
            switch (sentiment) {
                case 'positive':
                    return '<span class="badge badge-positive">–ü–æ–∑–∏—Ç–∏–≤–Ω–æ–µ</span>';
                case 'negative':
                    return '<span class="badge badge-negative">–ù–µ–≥–∞—Ç–∏–≤–Ω–æ–µ</span>';
                case 'neutral':
                default:
                    return '<span class="badge badge-neutral">–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ</span>';
            }
        }

        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(loadData, 30000);
    </script>
</body>
</html> 